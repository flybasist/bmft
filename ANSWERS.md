# ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ñ‚Ğ²Ğ¾Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ + ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

## âœ… ĞÑ‚Ğ²ĞµÑ‚Ñ‹:

### 01 - Webhook vs Long Polling
**ĞÑ‚Ğ²ĞµÑ‚:** Ğ‘ÑƒĞ´ĞµĞ¼ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ **Long Polling** (ĞºĞ°Ğº Ğ² Python Ğ²ĞµÑ€ÑĞ¸Ğ¸).

**ĞŸĞ¾ÑÑĞ½ĞµĞ½Ğ¸Ğµ:** Webhook Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚:
- ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ¼ĞµĞ½ Ñ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ¼
- Telegram Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ POST Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ½Ğ° Ñ‚Ğ²Ğ¾Ğ¹ URL
- ĞœĞµĞ½ÑŒÑˆĞµ latency, Ğ½Ğ¾ ÑĞ»Ğ¾Ğ¶Ğ½ĞµĞµ setup

Long Polling (Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´):
- Ğ‘Ğ¾Ñ‚ ÑĞ°Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñƒ Telegram
- ĞĞµ Ğ½ÑƒĞ¶ĞµĞ½ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ¼ĞµĞ½
- ĞŸÑ€Ğ¾Ñ‰Ğµ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¸ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ
- Ğ”Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ñ‚Ğ²Ğ¾ĞµĞ³Ğ¾ RPS (~0.004)

### 02 - Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ‘Ğ”
**ĞÑ‚Ğ²ĞµÑ‚:** âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ° **Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°** Ğ² `migrations/001_initial_schema.sql`

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ:**
1. **Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `messages`** Ğ²Ğ¼ĞµÑÑ‚Ğ¾ `{chat_id}` Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
   - ĞŸĞ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğµ (messages_2025_10, messages_2025_11, etc.)
   - Ğ›ĞµĞ³Ñ‡Ğµ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ
   - ĞŸÑ€Ğ¾Ñ‰Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹

2. **ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `limiter_config`**
   - ĞĞ´Ğ½Ğ° ÑÑ‚Ñ€Ğ¾ĞºĞ° = Ğ¾Ğ´Ğ¸Ğ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
   - ĞĞµ 12 ĞºĞ¾Ğ»Ğ¾Ğ½Ğ¾Ğº (audio, photo, video...), Ğ°:
     ```sql
     {chat_id, user_id, content_type, daily_limit}
     ```

3. **Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `chat_modules`** Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸
   - ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
   - `config JSONB` Ğ´Ğ»Ñ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ

4. **Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `chat_admins`** Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸
   - ĞĞ´Ğ¼Ğ¸Ğ½Ñ‹ Ñ‡Ğ°Ñ‚Ğ¾Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ÑÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ ÑĞ°Ğ¼Ğ¾ÑÑ‚Ğ¾ÑÑ‚ĞµĞ»ÑŒĞ½Ğ¾
   - ĞĞµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ñ‚ĞµĞ±Ğµ Ğ² Ğ»Ğ¸Ñ‡ĞºÑƒ

### 03 - Scheduled tasks
**ĞÑ‚Ğ²ĞµÑ‚:** âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ **Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Scheduler**

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»:**
- Cron-Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ñ‡ĞµÑ€ĞµĞ· `github.com/robfig/cron/v3`
- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `scheduler_tasks` Ñ Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸:
  - `cron_expression`: `"0 9 * * *"` (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² 9:00)
  - `task_type`: `"sticker"`, `"text"`, `"poll"`
  - `task_data`: JSONB Ñ file_id ÑÑ‚Ğ¸ĞºĞµÑ€Ğ° Ğ¸Ğ»Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼
- ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ: `/addtask`, `/listtasks`, `/deltask`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸Ğ· Python:**
```python
# scheduletask.py
schedule.every().day.at("09:00").do(send_sticker, chatid, sticker_id)
```

**ĞĞ½Ğ°Ğ»Ğ¾Ğ³ Ğ² Go:**
```go
// internal/modules/scheduler/cron.go
c := cron.New()
c.AddFunc("0 9 * * *", func() {
    sendSticker(chatID, stickerID)
})
c.Start()
```

### 04 - ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñ‹
**ĞÑ‚Ğ²ĞµÑ‚:** âœ… ĞŸĞ»Ğ°Ğ½ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ â€” **8 Ñ„Ğ°Ğ·, 15-20 Ğ´Ğ½ĞµĞ¹**

**MVP (7-10 Ğ´Ğ½ĞµĞ¹):**
- Ğ¤Ğ°Ğ·Ğ° 1: Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ°Ñ€ĞºĞ°Ñ (Ğ±ĞµĞ· Kafka, telebot.v3)
- Ğ¤Ğ°Ğ·Ğ° 2: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Limiter (Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ½Ğ° ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚)
- Ğ¤Ğ°Ğ·Ğ° 3: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Reactions (Ñ€ĞµĞ°ĞºÑ†Ğ¸Ğ¸ Ğ½Ğ° ÑĞ»Ğ¾Ğ²Ğ°)
- Ğ¤Ğ°Ğ·Ğ° 4: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Statistics (ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°)

**Full (12-16 Ğ´Ğ½ĞµĞ¹):**
- Ğ¤Ğ°Ğ·Ğ° 5: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Scheduler (Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ)
- Ğ¤Ğ°Ğ·Ğ° 7: ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹)

**Production (15-20 Ğ´Ğ½ĞµĞ¹):**
- Ğ¤Ğ°Ğ·Ğ° 8: ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸, CI/CD, Ğ±ÑĞºĞ°Ğ¿Ñ‹

### 05 - ĞĞ´Ğ¼Ğ¸Ğ½ĞºĞ°
**ĞÑ‚Ğ²ĞµÑ‚:** âœ… ĞŸĞ¾ĞºĞ° **ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ² Telegram**

**Ğ‘ÑƒĞ´ÑƒÑ‰ĞµĞµ:** Telegram Mini App (WebView)
- Ğ­Ñ‚Ğ¾ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Telegram
- ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ñ React/Vue
- ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ ĞºĞ½Ğ¾Ğ¿ĞºĞµ Ğ² Ñ‡Ğ°Ñ‚Ğµ Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼
- ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ğ°Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞ° Ñ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ°Ğ¼Ğ¸ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸

---

## ğŸ§© ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: Plugin-based Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ "ĞšĞ°Ñ€ĞºĞ°Ñ + ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½Ñ‹"

```
Ğ¯Ğ”Ğ Ğ (Core Framework)
â”œâ”€â”€ Bot initialization
â”œâ”€â”€ Module registry
â”œâ”€â”€ Message routing
â””â”€â”€ Database layer

ĞŸĞ›ĞĞ“Ğ˜ĞĞ« (Modules)
â”œâ”€â”€ Limiter        â† Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ per chat
â”œâ”€â”€ Reactions      â† Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ per chat
â”œâ”€â”€ AntiSpam       â† Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ per chat
â”œâ”€â”€ Statistics     â† Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ per chat
â”œâ”€â”€ Scheduler      â† Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ per chat
â””â”€â”€ Custom Module  â† Ñ‚Ğ²Ğ¾Ğ¹ ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
```

### ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:

#### 1. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ = Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ

```go
type Module interface {
    Name() string                                  // "limiter"
    Description() string                           // "Ğ›Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ½Ğ° ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚"
    Init(deps *ModuleDependencies) error          // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
    OnMessage(ctx *MessageContext) error          // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
    Commands() []Command                           // ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
    Shutdown() error                               // ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ
}
```

#### 2. Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ/Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ per chat

```sql
-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° chat_modules
chat_id  | module_name | is_enabled | config
---------+-------------+------------+------------------------
-1001... | limiter     | true       | {"max_warnings": 3}
-1001... | reactions   | true       | {}
-1001... | antispam    | false      | {"threshold": 5}
36382... | limiter     | true       | {}
36382... | reactions   | false      | {}
```

**ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:**
```
/modules                    # Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
/modules enable limiter     # Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ limiter
/modules disable antispam   # Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ antispam
```

#### 3. ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹

**ĞŸĞ»Ğ¾Ñ…Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ):**
```go
// âŒ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ reactions Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ limiter
func (r *ReactionsModule) OnMessage(ctx *MessageContext) error {
    limit := ctx.Limiter.GetLimit(...) // Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ!
}
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ (Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ):**
```go
// âœ… ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ½Ğµ Ğ·Ğ½Ğ°ÑÑ‚ Ğ´Ñ€ÑƒĞ³ Ğ¾ Ğ´Ñ€ÑƒĞ³Ğµ
func (r *ReactionsModule) OnMessage(ctx *MessageContext) error {
    // ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ÑĞ°Ğ¼ Ğ¿Ğ¾ ÑĞµĞ±Ğµ
    // ĞĞ±Ñ‰Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ‘Ğ”, Ğ½Ğµ Ğ² Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ…
}
```

#### 4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ = 5 ÑˆĞ°Ğ³Ğ¾Ğ²

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ "Captcha" Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²**

**Ğ¨Ğ°Ğ³ 1:** Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ
```bash
mkdir -p internal/modules/captcha
touch internal/modules/captcha/{module.go,service.go,repository.go,commands.go}
```

**Ğ¨Ğ°Ğ³ 2:** Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Module
```go
// internal/modules/captcha/module.go
package captcha

type CaptchaModule struct {
    name string
    // ...
}

func New() *CaptchaModule {
    return &CaptchaModule{name: "captcha"}
}

func (m *CaptchaModule) Name() string { return m.name }
func (m *CaptchaModule) Init(...) error { /* ... */ }
func (m *CaptchaModule) OnMessage(...) error {
    // Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° ĞºĞ°Ğ¿Ñ‡Ğ¸ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²
}
func (m *CaptchaModule) Commands() []Command {
    return []Command{
        {Command: "/setcaptcha", Handler: m.handleSetCaptcha},
    }
}
```

**Ğ¨Ğ°Ğ³ 3:** Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ² Ğ‘Ğ” (Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ)
```sql
-- migrations/002_add_captcha.sql
CREATE TABLE captcha_config (
    chat_id BIGINT PRIMARY KEY,
    captcha_type VARCHAR(20), -- 'math', 'button', 'image'
    timeout_seconds INT DEFAULT 60,
    ban_on_failure BOOLEAN DEFAULT false
);
```

**Ğ¨Ğ°Ğ³ 4:** Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
```go
// cmd/bot/main.go
registry.Register(limiter.New())
registry.Register(reactions.New())
registry.Register(captcha.New()) // <- Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
```

**Ğ¨Ğ°Ğ³ 5:** Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾! ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ñ‡ĞµÑ€ĞµĞ· `/modules enable captcha`

### ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

**Ğ’ÑĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ÑÑ:**
```sql
-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° event_log
SELECT * FROM event_log WHERE event_type = 'limit_exceeded';
SELECT * FROM event_log WHERE module_name = 'antispam';
```

**Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼:**
```sql
-- Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ· ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ» limiter Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ?
SELECT COUNT(*) FROM event_log 
WHERE module_name = 'limiter' 
AND created_at > NOW() - INTERVAL '7 days';

-- ĞšĞ°ĞºĞ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ ÑĞ°Ğ¼Ñ‹Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ?
SELECT module_name, COUNT(*) as events
FROM event_log
GROUP BY module_name
ORDER BY events DESC;
```

**ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹:**
```sql
-- messages Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° â€” ĞµĞ´Ğ¸Ğ½Ğ°Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ñ‡Ğ°Ñ‚Ğ¾Ğ²
-- Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ ĞºÑ€Ğ¾ÑÑ-Ñ‡Ğ°Ñ‚Ğ¾Ğ²ÑƒÑ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ

-- Ğ¡Ğ°Ğ¼Ñ‹Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ‡Ğ°ÑÑ‹:
SELECT EXTRACT(HOUR FROM created_at) as hour, COUNT(*)
FROM messages
GROUP BY hour
ORDER BY hour;

-- Ğ Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ¾Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°:
SELECT content_type, COUNT(*)
FROM messages
WHERE created_at > NOW() - INTERVAL '30 days'
GROUP BY content_type;

-- Ğ¢Ğ¾Ğ¿ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¿Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑĞ¼:
SELECT u.username, COUNT(m.id) as msg_count
FROM messages m
JOIN users u ON u.user_id = m.user_id
GROUP BY u.username
ORDER BY msg_count DESC
LIMIT 10;
```

---

## ğŸ“¦ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ñ‡ĞµÑ€ĞµĞ· JSONB

```sql
-- ĞœĞ¾Ğ´ÑƒĞ»ÑŒ limiter Ñ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¼Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
INSERT INTO chat_modules (chat_id, module_name, is_enabled, config) VALUES
(-1001637543078, 'limiter', true, '{
  "max_warnings": 3,
  "reset_warnings_after_hours": 24,
  "vip_users": [36382182, 227345104]
}');

-- ĞœĞ¾Ğ´ÑƒĞ»ÑŒ antispam Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
INSERT INTO chat_modules (chat_id, module_name, is_enabled, config) VALUES
(-1001637543078, 'antispam', true, '{
  "flood_threshold": 5,
  "flood_window_seconds": 10,
  "ban_duration_seconds": 3600,
  "whitelist_domains": ["github.com", "stackoverflow.com"]
}');
```

**Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ° Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ:**
```go
func (m *AntiSpamModule) OnMessage(ctx *MessageContext) error {
    config, _ := ctx.GetChatConfig(m.name)
    
    floodThreshold := config["flood_threshold"].(float64) // 5
    whitelistDomains := config["whitelist_domains"].([]interface{})
    
    // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
}
```

---

## ğŸš€ Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Telegram Bot API                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Long Polling
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Core Framework (Ğ¯Ğ´Ñ€Ğ¾)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Module Registry                                   â”‚  â”‚
â”‚  â”‚ - RegisterModule()                                â”‚  â”‚
â”‚  â”‚ - GetActiveModules(chatID)                        â”‚  â”‚
â”‚  â”‚ - RouteMessage(message) â†’ []Module                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Message Router                                    â”‚  â”‚
â”‚  â”‚ For each active module:                           â”‚  â”‚
â”‚  â”‚   module.OnMessage(context)                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Limiter â”‚    â”‚Reactionsâ”‚    â”‚ AntiSpam â”‚    â”‚ Custom   â”‚
â”‚ Module  â”‚    â”‚ Module  â”‚    â”‚ Module   â”‚    â”‚ Module   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   PostgreSQL    â”‚
            â”‚  - messages     â”‚
            â”‚  - chat_modules â”‚
            â”‚  - limiter_*    â”‚
            â”‚  - reactions_*  â”‚
            â”‚  - event_log    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹:**
1. **ĞĞ´Ğ¸Ğ½ message â†’ Ğ²ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸** (Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)
2. **ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒÑÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹** â†’ Ğ±Ğ¾Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¸Ñ… Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚
3. **Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ/Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ per chat** â†’ Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ñ‡Ğ°Ñ‚Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚
4. **ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ°** â†’ Ğ²ÑĞµ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ‘Ğ”
5. **ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ = +1 Ñ„Ğ°Ğ¹Ğ» Ğ² registry** â†’ Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² core

---

## âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğº ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼Ñƒ ÑˆĞ°Ğ³Ñƒ

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾:
- âœ… SQL ÑÑ…ĞµĞ¼Ğ°: `migrations/001_initial_schema.sql`
- âœ… ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ: `ARCHITECTURE.md`
- âœ… ĞŸĞ»Ğ°Ğ½ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸: `MIGRATION_PLAN.md`
- âœ… ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹: ÑÑ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ»

**Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑˆĞ°Ğ³: Ğ¤Ğ°Ğ·Ğ° 1 â€” Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ°Ñ€ĞºĞ°Ñ**

ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Kafka Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ core framework?
