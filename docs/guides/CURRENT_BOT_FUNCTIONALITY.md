# ü§ñ –¢–µ–∫—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ—Ç–∞ (Phase 1)

**–í–µ—Ä—Å–∏—è:** 0.2.1  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π  
**–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç:** Phase 1 Complete

---

## üéØ –ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç –°–ï–ô–ß–ê–°:

### 1. **–ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (5 —à—Ç—É–∫):**

#### `/start` ‚Äî –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
**–ö—Ç–æ –º–æ–∂–µ—Ç:** –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å —á–∞—Ç–∞ –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ `chats`)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç welcome message —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
- –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ `event_log` (audit trail)

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```
ü§ñ –ü—Ä–∏–≤–µ—Ç! –Ø BMFT ‚Äî –º–æ–¥—É–ª—å–Ω—ã–π –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram-—á–∞—Ç–∞–º–∏.

üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/help ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
/modules ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)
/enable <module> ‚Äî –≤–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)
/disable <module> ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)

–î–æ–±–∞–≤—å—Ç–µ –º–µ–Ω—è –≤ –≥—Ä—É–ø–ø—É –∏ –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏!
```

---

#### `/help` ‚Äî –°–ø—Ä–∞–≤–∫–∞
**–ö—Ç–æ –º–æ–∂–µ—Ç:** –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ –±—É–¥—É—â–∏—Ö –º–æ–¥—É–ª—è—Ö (limiter, reactions, statistics, scheduler, antispam)

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```
üìñ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

üîπ –û—Å–Ω–æ–≤–Ω—ã–µ:
/start ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
/help ‚Äî —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

üîπ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã):
/modules ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏
/enable <module> ‚Äî –≤–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å
/disable <module> ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å

üîπ –ú–æ–¥—É–ª–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Phase 2-6:
- limiter ‚Äî –ª–∏–º–∏—Ç—ã –Ω–∞ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- reactions ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏
- statistics ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞
- scheduler ‚Äî –∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- antispam ‚Äî –∞–Ω—Ç–∏—Å–ø–∞–º —Ñ–∏–ª—å—Ç—Ä—ã
```

---

#### `/modules` ‚Äî –°–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π
**–ö—Ç–æ –º–æ–∂–µ—Ç:** ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —á–∞—Ç–∞ (–≤ –≥—Ä—É–ø–ø–∞—Ö)  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ `bot.AdminsOf()`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–º (‚úÖ –í–∫–ª—é—á–µ–Ω / ‚ùå –í—ã–∫–ª—é—á–µ–Ω)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è

**–°–µ–π—á–∞—Å:**
```
üì¶ –ú–æ–¥—É–ª–∏ –ø–æ–∫–∞ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã. –ë—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Phase 2-6.
```

**–ü–æ—Å–ª–µ Phase 2 (–ø—Ä–∏–º–µ—Ä):**
```
üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏:

üîπ limiter ‚Äî ‚úÖ –í–∫–ª—é—á–µ–Ω
  –ö–æ–º–∞–Ω–¥—ã: /setlimit, /showlimits, /mystats

üîπ reactions ‚Äî ‚ùå –í—ã–∫–ª—é—á–µ–Ω
  –ö–æ–º–∞–Ω–¥—ã: /addreaction, /listreactions, /delreaction
```

---

#### `/enable <module>` ‚Äî –í–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å
**–ö—Ç–æ –º–æ–∂–µ—Ç:** ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —á–∞—Ç–∞  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –º–æ–¥—É–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `ModuleRegistry`
- –í–∫–ª—é—á–∞–µ—Ç –º–æ–¥—É–ª—å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞ (–∑–∞–ø–∏—Å—å –≤ `chat_modules`)
- –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ `event_log`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```
/enable limiter
```

**–û—Ç–≤–µ—Ç:**
```
‚úÖ –ú–æ–¥—É–ª—å 'limiter' –≤–∫–ª—é—á–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞.
```

**–ï—Å–ª–∏ –º–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω:**
```
‚ùå –ú–æ–¥—É–ª—å 'limiter' –Ω–µ –Ω–∞–π–¥–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /modules –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥—É–ª–µ–π.
```

---

#### `/disable <module>` ‚Äî –í—ã–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å
**–ö—Ç–æ –º–æ–∂–µ—Ç:** ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —á–∞—Ç–∞  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –í—ã–∫–ª—é—á–∞–µ—Ç –º–æ–¥—É–ª—å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `chat_modules.is_enabled = FALSE`)
- –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ `event_log`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```
/disable limiter
```

**–û—Ç–≤–µ—Ç:**
```
‚ùå –ú–æ–¥—É–ª—å 'limiter' –≤—ã–∫–ª—é—á–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞.
```

---

### 2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:**

#### `OnText` handler
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –õ–æ–≤–∏—Ç –í–°–ï —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ
- –°–æ–∑–¥–∞—ë—Ç `MessageContext` —Å –ø–æ–ª–µ–∑–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (Message, Bot, DB, Logger, Chat, Sender)
- –ü–µ—Ä–µ–¥–∞—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ `ModuleRegistry.OnMessage()`
- `ModuleRegistry` –≤—ã–∑—ã–≤–∞–µ—Ç `OnMessage()` —É **–≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π** –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞

**–°–µ–π—á–∞—Å:** –ú–æ–¥—É–ª–µ–π –Ω–µ—Ç ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç  
**–ü–æ—Å–ª–µ Phase 2:** Limiter Module –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–∏–º–∏—Ç—ã –Ω–∞ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ/—Å—Ç–∏–∫–µ—Ä—ã

---

### 3. **–ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é):**

#### Module Registry
**–ß—Ç–æ —ç—Ç–æ:**
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- –£–ø—Ä–∞–≤–ª—è–µ—Ç lifecycle: `Init()` ‚Üí `OnMessage()` ‚Üí `Shutdown()`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞ —á–µ—Ä–µ–∑ `Enabled(chatID)`

**–ú–µ—Ç–æ–¥—ã:**
```go
registry.Register("limiter", &limiter.Module{})  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è
registry.InitAll()                                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö
registry.OnMessage(ctx)                           // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
registry.GetModules()                             // –°–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π
registry.ShutdownAll()                            // Graceful shutdown
```

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```go
// TODO: –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏ –∑–¥–µ—Å—å (Phase 2-6)
// registry.Register("limiter", &limiter.Module{})
// registry.Register("reactions", &reactions.Module{})
// registry.Register("statistics", &statistics.Module{})
// registry.Register("scheduler", &scheduler.Module{})
```

---

### 4. **Middleware (3 —Ñ—É–Ω–∫—Ü–∏–∏):**

#### LoggerMiddleware
- –õ–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥–æ–µ –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (chat_id, user_id, text preview)
- –ü–æ–º–æ–≥–∞–µ—Ç –≤ –¥–µ–±–∞–≥–µ –∏ –∞—É–¥–∏—Ç–µ

#### PanicRecoveryMiddleware
- –õ–æ–≤–∏—Ç panic –≤ —Ö–µ–Ω–¥–ª–µ—Ä–∞—Ö
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–∞–¥–µ–Ω–∏–µ –≤—Å–µ–≥–æ –±–æ—Ç–∞ –∏–∑-–∑–∞ –æ–¥–Ω–æ–π –æ—à–∏–±–∫–∏
- –õ–æ–≥–∏—Ä—É–µ—Ç stack trace

#### RateLimitMiddleware (placeholder)
- –°–µ–π—á–∞—Å: –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç "rate limit check"
- –í –±—É–¥—É—â–µ–º: –∑–∞—â–∏—Ç–∞ –æ—Ç flood (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10 –∫–æ–º–∞–Ω–¥ –≤ –º–∏–Ω—É—Ç—É)

---

### 5. **Repository Layer (—Ä–∞–±–æ—Ç–∞ —Å –ë–î):**

#### ChatRepository
**–ú–µ—Ç–æ–¥—ã:**
- `GetOrCreate(chatID, chatType, title, username)` ‚Äî —Å–æ–∑–¥–∞—Ç—å —á–∞—Ç –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `IsActive(chatID)` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —á–∞—Ç–∞
- `Deactivate(chatID)` ‚Äî –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç
- `GetChatInfo(chatID)` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Ç–µ

#### ModuleRepository
**–ú–µ—Ç–æ–¥—ã:**
- `IsEnabled(chatID, moduleName)` ‚Äî –≤–∫–ª—é—á–µ–Ω –ª–∏ –º–æ–¥—É–ª—å –¥–ª—è —á–∞—Ç–∞
- `Enable(chatID, moduleName)` ‚Äî –≤–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å
- `Disable(chatID, moduleName)` ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å
- `GetConfig(chatID, moduleName)` ‚Äî –ø–æ–ª—É—á–∏—Ç—å JSONB –∫–æ–Ω—Ñ–∏–≥ –º–æ–¥—É–ª—è
- `UpdateConfig(chatID, moduleName, config)` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å JSONB –∫–æ–Ω—Ñ–∏–≥
- `GetEnabledModules(chatID)` ‚Äî —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π

#### EventRepository
**–ú–µ—Ç–æ–¥—ã:**
- `Log(chatID, userID, module, eventType, details)` ‚Äî –∑–∞–ø–∏—Å–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ audit log
- `GetRecentEvents(chatID, limit)` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–±—ã—Ç–∏–π

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `event_log` –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –∞—É–¥–∏—Ç–∞.

---

### 6. **Graceful Shutdown:**

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ Ctrl+C (SIGINT) –∏–ª–∏ SIGTERM:**
1. –ë–æ—Ç –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (`bot.Stop()`)
2. –í—Å–µ –º–æ–¥—É–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç —Ä–∞–±–æ—Ç—É (`registry.ShutdownAll()`)
3. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å PostgreSQL (`db.Close()`)
4. –ï—Å–ª–∏ shutdown –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç (15 —Å–µ–∫—É–Ω–¥) ‚Üí forced exit
5. –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

**–õ–æ–≥ –ø—Ä–∏–º–µ—Ä–∞:**
```
2025-10-04T12:00:00.000Z  INFO  received shutdown signal  {"signal": "interrupt"}
2025-10-04T12:00:00.001Z  INFO  shutting down bot...
2025-10-04T12:00:00.005Z  INFO  shutting down modules...
2025-10-04T12:00:00.010Z  INFO  closing database connection...
2025-10-04T12:00:00.015Z  INFO  bot shutdown complete
```

---

### 7. **Long Polling (60 —Å–µ–∫—É–Ω–¥):**

**–ß—Ç–æ —ç—Ç–æ:**
- –ë–æ—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç webhook –∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞
- –ë–æ—Ç —Å–∞–º –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram API –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```env
POLLING_TIMEOUT=60  # —Å–µ–∫—É–Ω–¥
```

---

### 8. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL:**

#### –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
1. **`chats`** ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–∞—Ç–æ–≤ (chat_id, type, title, username)
2. **`chat_modules`** ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞ + JSONB config
3. **`event_log`** ‚Äî audit trail –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π (–∫–æ–º–∞–Ω–¥—ã, —Å–æ–±—ã—Ç–∏—è –º–æ–¥—É–ª–µ–π)
4. **`messages`** ‚Äî –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
5. **`user_stats`** ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
```bash
migrations/001_initial_schema.sql  # ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞
migrations/002_limiter_tables.sql  # ‚è≥ –ë—É–¥–µ—Ç –≤ Phase 2
```

---

### 9. **Docker –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:**

#### Dockerfile
- Multi-stage build (golang:1.25-alpine ‚Üí alpine:latest)
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –±–∏–Ω–∞—Ä–Ω–∏–∫ (—Ä–∞–∑–º–µ—Ä ~10M)
- Non-root user (bmft:bmft, uid 1000)
- Healthcheck –Ω–∞ `:9090/healthz` (–¥–ª—è –±—É–¥—É—â–µ–≥–æ metrics server)

#### docker-compose.yaml
- **postgres** ‚Äî PostgreSQL 16-alpine —Å persistent volume
- **bot** ‚Äî –Ω–∞—à –±–æ—Ç —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º –∏ health checks
- Environment variables –∏–∑ `.env` —Ñ–∞–π–ª–∞
- Logging rotation (10MB, 3 —Ñ–∞–π–ª–∞)

**–ó–∞–ø—É—Å–∫:**
```bash
docker-compose up -d
docker-compose logs -f bot  # –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏
```

---

### 10. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (zap):**

#### Structured logging —Å –ø–æ–ª—è–º–∏:
```go
logger.Info("handling /start command",
    zap.Int64("chat_id", c.Chat().ID),
    zap.Int64("user_id", c.Sender().ID),
)
```

#### –†–µ–∂–∏–º—ã –≤—ã–≤–æ–¥–∞:
- **Production mode** (`LOGGER_PRETTY=false`) ‚Äî JSON –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–≤ (ELK, Loki)
- **Development mode** (`LOGGER_PRETTY=true`) ‚Äî —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥

#### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
```env
LOG_LEVEL=debug   # debug, info, warn, error
```

**–ü—Ä–∏–º–µ—Ä JSON –ª–æ–≥–∞:**
```json
{
  "ts": "2025-10-04T12:00:00.000Z",
  "level": "info",
  "msg": "bot started successfully",
  "bot_username": "bmft_test_bot",
  "bot_id": 123456789
}
```

---

## ‚úÖ –ß—Ç–æ –±–æ—Ç –£–ñ–ï —É–º–µ–µ—Ç (Phase 1-2 –∑–∞–≤–µ—Ä—à–µ–Ω—ã):

### ‚úÖ Core Framework (Phase 1) ‚Äî 100% Complete
- –ú–æ–¥—É–ª—å–Ω–∞—è plugin-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- Module Registry —Å lifecycle management
- –ö–æ–º–∞–Ω–¥—ã: `/start`, `/help`, `/modules`, `/enable`, `/disable`
- PostgreSQL –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å migrations
- Repository Layer (ChatRepository, ModuleRepository, EventRepository)
- Graceful shutdown —Å —Ç–∞–π–º–∞—É—Ç–æ–º
- Structured logging (zap)
- Middleware: Logger, PanicRecovery, RateLimit
- Docker –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å (Dockerfile + docker-compose)

### ‚úÖ Limiter Module (Phase 2) ‚Äî 100% Complete
- –õ–∏–º–∏—Ç—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–æ—Ç—É (daily/monthly per user)
- –ö–æ–º–∞–Ω–¥—ã: `/limits`, `/setlimit <user_id> daily|monthly <limit>`, `/getlimit <user_id>`
- –ê–≤—Ç–æ—Å–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–æ–≤ (daily –≤ 00:00 UTC, monthly –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü)
- Unit-—Ç–µ—Å—Ç—ã (10 —Ç–µ—Å—Ç–æ–≤, 485 —Å—Ç—Ä–æ–∫)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å main.go

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –¢–µ–∫—É—â–∞—è Phase 2 —Ä–µ–∞–ª–∏–∑—É–µ—Ç user request limiter. Content type limiter (photo/video/sticker –∏–∑ Python –±–æ—Ç–∞) –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å.

---

## üö´ –ß—Ç–æ –±–æ—Ç –ù–ï —É–º–µ–µ—Ç (–±—É–¥–µ—Ç –≤ Phase 3-5, Phase AI):

### ‚ùå Reactions Module (Phase 3 ‚Äî –°–ª–µ–¥—É—é—â–∞—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (regex)
- –ú–∏–≥—Ä–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏–∑ Python –±–æ—Ç–∞ (rts_bot)
- –ö–æ–º–∞–Ω–¥—ã: `/addreaction`, `/listreactions`, `/delreaction`, `/testreaction`
- Cooldown —Å–∏—Å—Ç–µ–º–∞ (10 –º–∏–Ω—É—Ç –º–µ–∂–¥—É —Ä–µ–∞–∫—Ü–∏—è–º–∏)
- –ê–Ω—Ç–∏—Ñ–ª—É–¥ —á–µ—Ä–µ–∑ reactions_log
- –ü–æ–¥—Å—á—ë—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π (violation_code=21)

### ‚ùå Statistics Module (Phase 4)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ö–æ–º–∞–Ω–¥—ã: `/mystats` (–ª–∏—á–Ω–∞—è), `/chatstats` (–∞–¥–º–∏–Ω)
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∏–∑ messages ‚Üí statistics_daily
- Top users, most active hours
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –ø–æ —Ç–∏–ø–∞–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### ‚ùå Scheduler Module (Phase 5)
- –ó–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron-like –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)
- –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á –∏–∑ Python scheduletask.py
- Scheduled stickers, announcements, reminders
- –ö–æ–º–∞–Ω–¥—ã: `/addtask`, `/listtasks`, `/deltask`, `/runtask`

### ‚ùå AI Module (Phase AI ‚Äî –í –±—É–¥—É—â–µ–º)
- OpenAI/Anthropic API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Context Management (–∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤)
- –ö–æ–º–∞–Ω–¥—ã: `/gpt`, `/reset`, `/context`
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Limiter Module –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤ –ø–µ—Ä–µ–¥ AI –∑–∞–ø—Ä–æ—Å–∞–º–∏

### ‚ùå AntiSpam Module (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Flood protection
- Link filtering
- User reputation system

---

## üéØ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
docker run -d --name postgres \
  -e POSTGRES_PASSWORD=secret \
  -p 5432:5432 \
  postgres:16

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
migrate -path migrations \
  -database "postgres://postgres:secret@localhost/postgres?sslmode=disable" up

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example –≤ .env –∏ —É–∫–∞–∂–∏—Ç–µ TELEGRAM_BOT_TOKEN
cp .env.example .env
nano .env  # –£–∫–∞–∂–∏—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
```

### 2. –ó–∞–ø—É—Å–∫:
```bash
go run cmd/bot/main.go
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
2025-10-04T12:00:00.000Z  INFO  starting bmft bot  {"log_level": "debug", "polling_timeout": 60}
2025-10-04T12:00:01.000Z  INFO  connected to postgresql
2025-10-04T12:00:02.000Z  INFO  bot created successfully  {"bot_username": "your_bot", "bot_id": 123456}
2025-10-04T12:00:02.100Z  INFO  bot started, polling for updates...
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥:

#### –í –ª–∏—á–∫–µ —Å –±–æ—Ç–æ–º:
```
/start     ‚Üí Welcome message
/help      ‚Üí –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
/modules   ‚Üí "–ú–æ–¥—É–ª–∏ –ø–æ–∫–∞ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã"
```

#### –í –≥—Ä—É–ø–ø–µ (–¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∏ –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞):
```
/start     ‚Üí Welcome message
/help      ‚Üí –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
/modules   ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞ + —Å–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π
/enable limiter   ‚Üí "–ú–æ–¥—É–ª—å 'limiter' –Ω–µ –Ω–∞–π–¥–µ–Ω" (–º–æ–¥—É–ª—å –ø–æ–∫–∞ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω)
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î:
```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–∞—Ç—ã
SELECT * FROM chats;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–±—ã—Ç–∏—è
SELECT * FROM event_log ORDER BY created_at DESC LIMIT 10;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–¥—É–ª–∏ (–ø–æ–∫–∞ –ø—É—Å—Ç–æ)
SELECT * FROM chat_modules;
```

### 5. Graceful Shutdown:
```bash
# –ù–∞–∂–º–∏—Ç–µ Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å –±–æ—Ç–æ–º
^C

# –£–≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:
INFO  received shutdown signal  {"signal": "interrupt"}
INFO  shutting down bot...
INFO  shutting down modules...
INFO  closing database connection...
INFO  bot shutdown complete
```

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π:

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|----------|
| `/start` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + —Å–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞ –≤ –ë–î |
| `/help` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |
| `/modules` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –°–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π (–ø–æ–∫–∞ –ø—É—Å—Ç–æ–π) |
| `/enable <module>` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –í–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤) |
| `/disable <module>` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –í—ã–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü–µ—Ä–µ–¥–∞—á–∞ –≤ ModuleRegistry |
| Admin –ø—Ä–∞–≤–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ß–µ—Ä–µ–∑ `bot.AdminsOf()` |
| Audit logging | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ `event_log` |
| Middleware | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | Logger, Panic Recovery, Rate Limit |
| Graceful Shutdown | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | SIGINT/SIGTERM handling |
| Long Polling | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 60 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç |
| PostgreSQL | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 5 —Ç–∞–±–ª–∏—Ü + Repository layer |
| Docker | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | Dockerfile + docker-compose |
| Structured Logging | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | zap (JSON/Console) |
| **–ú–æ–¥—É–ª–∏** | ‚ùå –ü—É—Å—Ç–æ | –ë—É–¥—É—Ç –≤ Phase 2-6 |

---

## üéâ –í—ã–≤–æ–¥:

**–ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–µ–Ω!** 

–û–Ω —É—Å–ø–µ—à–Ω–æ:
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Telegram
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 5 –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å PostgreSQL —á–µ—Ä–µ–∑ Repository layer
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ audit trail
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –º–æ–¥—É–ª–µ–π (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞)
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ

**–ù–æ:** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π (limiter, reactions –∏ —Ç.–¥.) –ø–æ–∫–∞ –Ω–µ—Ç.  
**–≠—Ç–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ Phase 2-6.**

**Phase 1 = –±–∞–∑–æ–≤—ã–π –∫–∞—Ä–∫–∞—Å –≥–æ—Ç–æ–≤ ‚úÖ**  
**Phase 2 = –¥–æ–±–∞–≤–∏–º –ø–µ—Ä–≤—ã–π —Ä–µ–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å (Limiter) üöÄ**
